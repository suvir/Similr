<div class="section">
    <h1>Get a user's top tracks, albums, artists and playlists</h1>
    <p class="description">Using the Toplist model, let's see what are the current user's most-listened tracks, albums, artists and playlists.</p>

    <div class="reference">
        Reference: <a href="https://developer.spotify.com/docs/apps/api/1.0/api-models-track.html">Track Model</a>, <a href="https://developer.spotify.com/docs/apps/api/1.0/api-models-album.html">Album Model</a>, <a href="https://developer.spotify.com/docs/apps/api/1.0/api-models-artist.html">Artist Model</a>, <a href="https://developer.spotify.com/docs/apps/api/1.0/api-models-playlist.html">Playlist Model</a> and <a href="https://developer.spotify.com/docs/apps/api/1.0/api-toplists-toplist.html">Toplist Model</a>.
    </div>

    <h3>The Javascript</h3>
    <div id="js"></div>

    <h3>The HTML</h3>
    <div id="html"></div>

    <h3>Live Example</h3>
    <div class="html-snippet" data-container="html">
        <h4>My top tracks</h4>
        <ul id="toplist-tracks"></ul>

        <h4>My top albums</h4>
        <ul id="toplist-albums"></ul>

        <h4>My top playlists</h4>
        <ul id="toplist-playlists"></ul>

        <h4>My top artists</h4>
        <ul id="toplist-artists"></ul>
    </div>
    <script type="script/snippet" data-container="js">
        require(['$api/toplists#Toplist'], function(Toplist) {
            var toplist = Toplist.forCurrentUser();

            // top tracks
            toplist.tracks.snapshot().done(function(tracks) {
                var promises = [];
                for (var i = 0, l = tracks.length; i < l; i++) {
                    var track = tracks.get(i);
                    promises.push(track.load('uri', 'name'));
                }

                models.Promise.join(promises).done(function(tracksPromises) {
                    var tracksFragment = document.createDocumentFragment();
                    tracksPromises.forEach(function(tp) {
                        var link = document.createElement('li');
                        var a = document.createElement('a');
                        a.href = tp.uri;
                        a.innerHTML = tp.name.decodeForHtml();
                        link.appendChild(a);
                        tracksFragment.appendChild(link);
                    });
                    document.getElementById('toplist-tracks').appendChild(tracksFragment);
                });
            });

            // top albums
            toplist.albums.snapshot().done(function(albums) {
                var promises = [];
                for (var i = 0, l = albums.length; i < l; i++) {
                    var album = albums.get(i);
                    promises.push(album.load('uri', 'name'));
                }

                models.Promise.join(promises).done(function(albumsPromises) {
                    var albumsFragment = document.createDocumentFragment();
                    albumsPromises.forEach(function(ap) {
                        var link = document.createElement('li');
                        var a = document.createElement('a');
                        a.href = ap.uri;
                        a.innerHTML = ap.name.decodeForHtml();
                        link.appendChild(a);
                        albumsFragment.appendChild(link);
                    });
                    document.getElementById('toplist-albums').appendChild(albumsFragment);
                });
            });

            // top artists
            toplist.artists.snapshot().done(function(artists) {
                var promises = [];
                for (var i = 0, l = artists.length; i < l; i++) {
                    var artist = artists.get(i);
                    promises.push(artist.load('uri', 'name'));
                }

                models.Promise.join(promises).done(function(artistsPromises) {
                    var artistsFragment = document.createDocumentFragment();
                    artistsPromises.forEach(function(ap) {
                        var link = document.createElement('li');
                        var a = document.createElement('a');
                        a.href = ap.uri;
                        a.innerHTML = ap.name.decodeForHtml();
                        link.appendChild(a);
                        artistsFragment.appendChild(link);
                    });
                    document.getElementById('toplist-artists').appendChild(artistsFragment);
                });
            });

            // top playlists
            toplist.playlists.snapshot().done(function(playlists) {
                var promises = [];
                for (var i = 0, l = playlists.length; i < l; i++) {
                    var playlist = playlists.get(i);
                    promises.push(playlist.load('uri', 'name'));
                }

                models.Promise.join(promises).done(function(playlistsPromises) {
                    var playlistsFragment = document.createDocumentFragment();
                    playlistsPromises.forEach(function(ap) {
                        var link = document.createElement('li');
                        var a = document.createElement('a');
                        a.href = ap.uri;
                        a.innerHTML = ap.name.decodeForHtml();
                        link.appendChild(a);
                        playlistsFragment.appendChild(link);
                    });
                    document.getElementById('toplist-playlists').appendChild(playlistsFragment);
                });
            });

        });
    </script>
</div>
